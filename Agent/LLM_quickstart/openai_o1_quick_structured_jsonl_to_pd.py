from openai import OpenAI;from dotenv import load_dotenv;import os;load_dotenv()
openai = OpenAI(api_key=os.getenv("OPENAI_API_KEY"), base_url="https://api.openai.com/v1");import pandas as pd; import json

def get_key(msg):
    completion=openai.chat.completions.create(model="o1-preview",messages=[{"role":"user","content":f"""
- 답변은 json 형식으로 항목은 intent와 query로 구성되어 있다.
- 답변 형태는 다음과 같다. {"intent":1,"query":""}
- [주어진 대화]를 자세히 읽고 user의 intent를 일반대화를 원하는지와 과학상식 지식을 궁금해 하는지의 두 가지로 분류하라
- intent는 0 또는 1의 값을 가지며, 0은 일반대화, 1은 과학상식을 의미한다.
- query는 intent가 1일 경우, 사용자의 질문과 관련된 과학상식을 내부 데이터베이스에서 elasticsearch로 sparse retrieval 하기 위해 필요한 query를 한국어로 작성하여 query에 삽입하라.
- 과학상식의 요약은 다음과 같다
**요약:**

기업 내부 데이터베이스는 과학 전반에 걸친 다양한 분야와 주제를 포함하고 있습니다. 주요 분야와 내용은 다음과 같습니다.

### **1. 생물학 및 생명과학**

- **인체 생리학과 건강**
  - **영양소의 역할**: 비타민 A의 시력 유지, 아연의 상처 치유, 비타민 B6와 B12 결핍이 치매와 유사한 증상 유발, 칼륨 섭취가 고혈압 개선에 미치는 영향.
  - **노화와 면역 체계**: 노화 이론의 비교, 노인의 면역 기능 변화와 건강 영향, 노년기 신경증 증가와 사망률의 상관관계.
  - **운동과 에너지 대사**: 운동선수의 체력 향상 방법, 근육 운동 시 ATP 생산과 에너지 사용 과정.

- **유전학과 유전 질환**
  - **유전적 형질과 돌연변이**: 낫적혈구빈혈증과 지중해빈혈의 유전적 원인 및 패턴, G6PD 결핍의 유전적 특징과 영향.
  - **세포 및 분자 생물학**: 원핵세포와 진핵세포의 구조와 공통점, 세포 소기관의 기능(리보솜, 세포막, DNA 등).

- **생태학 및 환경 생물학**
  - **생태계와 먹이사슬**: 먹이 그물의 구성과 한계, 분해자의 역할, 생물 사이의 상호작용.
  - **적응과 진화**: 동물의 환경 적응 사례, 북극곰의 지방 축적, 색상 변화 능력을 통한 생존 전략.

- **식물학**
  - **식물의 구조와 기능**: 식물 세포의 특수 조직, 잎의 팽압과 수분 손실, 광합성 메커니즘.
  - **씨앗의 발아와 성장**: 온도가 씨앗 발아에 미치는 영향, 식물의 에너지 활용 방식.

---

### **2. 화학**

- **화학 원리와 반응**
  - **물질의 특성과 반응성**: 니오븀의 화학적 성질, HClO₃의 산성 강도, 알루미늄 염화물의 이온화.
  - **산과 염기, 용해도**: 강산과 강염기의 중화 반응, 헨리의 법칙과 기체 용해도, 몰 용해도와 용해도곱(Ksp).

- **유기화학과 분석화학**
  - **유기 화합물의 구조와 명명법**: 탄화수소의 명명법, CH₃CHBrCHClCH₂CH₃의 구조 분석.
  - **분광학적 분석 방법**: 리드베르크 방정식을 이용한 수소 스펙트럼 분석, 13C NMR을 통한 분자 구조 확인.

---

### **3. 물리학**

- **역학과 에너지**
  - **운동의 법칙**: 뉴턴의 운동 법칙 적용, 마찰력과 경사로에서의 알짜힘 계산.
  - **에너지 전환과 보존**: 위치 에너지와 운동 에너지의 상호 변환, 열에너지와 엔트로피 개념.

- **전기와 자기**
  - **전기 회로와 전자기 현상**: 전구에서의 전기 에너지 변환, 전자기파의 특성, 전자석의 자장 강도 조절.
  - **빛의 성질과 광학**: 빛의 산란으로 인한 하늘의 색 변화, 굴절 망원경의 원리, 물질의 투명성과 불투명성.

- **열역학과 물질의 상태 변화**
  - **열 에너지 전달**: 전도, 대류, 복사에 의한 열 전달 방식.
  - **양자역학과 상대성 이론**: 파울리 배타 원리, 전자 배치와 화학 반응, 상대성 이론의 광학적 현상 응용.

---

### **4. 지구과학 및 천문학**

- **지질학과 판구조론**
  - **지구의 내부 구조와 활동**: 지각 운동, 화산 활동, 지진 발생 메커니즘.
  - **암석과 광물**: 암석의 형성 과정과 분류, 광물의 화학적 특성.

- **천문학**
  - **태양계와 우주**: 행성들의 특징 비교, 별의 생명 주기와 핵융합 과정, 블랙홀의 성질.
  - **지구와 달의 운동**: 자전과 공전이 지구 환경에 미치는 영향, 일식과 월식의 원리.

- **기상학과 기후학**
  - **대기 현상과 기후 변화**: 기상 시스템 분석, 온실 효과와 지구 온난화, 기후 변화의 원인과 영향.

---

### **5. 환경과학 및 생태계**

- **환경 문제와 자원 관리**
  - **오염과 대책**: 산성비의 발생 원인, 대기 및 수질 오염의 영향, 환경 친화적 에너지 자원 활용.
  - **재활용과 지속 가능성**: 자원 보존의 중요성, 재생 에너지의 개발과 적용.

- **생태계 보전**
  - **생물 다양성**: 멸종 위기 종 보호, 생태계 복원 노력.
  - **인간 활동의 영향**: 삼림 벌채, 서식지 파괴, 농업 활동이 생태계에 미치는 영향.

---

### **6. 공학 및 기술**

- **에너지 기술**
  - **재생 가능 에너지**: 태양광 발전, 풍력 발전의 원리와 응용.
  - **전력 시스템**: 전기 회로 설계, 전압과 저항의 관계, 에너지 효율 향상 기술.

- **정보 기술 및 보안**
  - **프로그래밍과 알고리즘**: 프로그래밍 언어의 활용, 자료 구조와 알고리즘 분석.
  - **네트워크와 보안**: TCP/IP 프로토콜, 사이버 보안 위협과 대응 방안, 암호화 기술.

- **재료공학 및 환경공학**
  - **신소재 개발**: 금속과 합금의 특성, 반도체의 활용.
  - **환경 기술**: 폐기물 관리, 물 정화 기술, 지속 가능한 기술 개발.

---

### **7. 의학 및 건강**

- **질병과 면역**
  - **전염병의 원인과 예방**: 바이러스와 세균의 감염 메커니즘, 백신 개발의 중요성.
  - **유전 질환 관리**: 테이새크스병, 지중해빈혈 등 유전 질환의 원인과 치료 접근법.

- **영양과 대사**
  - **영양소의 소화와 흡수**: 탄수화물, 단백질, 지방의 대사 과정.
  - **건강한 식습관**: 비만 예방, 심혈관 질환과 식단의 관계.

---

### **8. 사회과학 및 심리학**

- **인구 통계와 사회 문제**
  - **노화의 사회적 영향**: 고령화로 인한 사회 변화, 노인 복지와 지원 정책.
  - **건강과 복지**: 사회적 지원이 개인 건강에 미치는 영향, 노인 학대 예방.

- **심리학과 행동 과학**
  - **인간의 발달과 성격**: 발달 심리학의 이론, 성격 형성과 행동 특성.
  - **정신 건강**: 스트레스와 신경증, 정신 질환의 원인과 치료 방법.

---

### **9. 과학적 연구 방법론**

- **실험 설계와 데이터 분석**
  - **과학적 방법론**: 가설 설정, 실험 계획 수립, 데이터 수집 및 해석.
  - **데이터 신뢰성과 정확성**: 실험의 반복성, 오차 분석, 통계적 유의성 평가.

- **과학사와 과학자들**
  - **과학의 역사적 발전**: 주요 과학적 발견과 혁신, 과학자들의 업적과 영향.

---

### **10. 기타 과학 지식**

- **최신 과학 기술**
  - **우주 탐사 및 기술 발전**: 우주 탐사의 역사와 최신 동향, 탐사 기술의 발전.
  - **나노기술과 유전자 공학**: 나노기술의 응용 분야, 유전자 편집 기술의 원리와 윤리적 이슈.

- **과학의 본질과 철학**
  - **과학 지식의 진화**: 새로운 발견에 따른 이론의 수정과 발전 과정.
  - **자연 현상에 대한 이해**: 과학적 사고 방식과 철학적 접근.

---

이러한 내용은 기업 내부 데이터베이스가 다루는 지식의 분야와 범위를 나타내며, 과학의 기초 원리부터 응용 분야까지 포괄적인 정보를 포함하고 있습니다. 이를 통해 LLM은 사용자의 질문이 해당 분야와 관련될 경우, 내부 데이터베이스를 참조하여 정확하고 전문적인 답변을 제공할 수 있습니다. 

[주어진 대화]
{msg}
"""}])    
    print(completion.choices[0].message.content)
    return completion.choices[0].message.content

# JSONL 파일 불러오기
file_path='/data/ephemeral/home/upstageailab-ir-competition-ir_s3/baseline/data/eval.jsonl' 
df=pd.read_json(file_path, lines=True)
df['key']=[get_key(msg) for msg in df['msg']]

# 칼럼 분류하기
def parse_key(json_str):
    try:
        data = json.loads(json_str)
        return data.get('intent',0), data.get('query',"")
    except json.JSONDecodeError:
        # JSON 파싱 실패 시 기본값 반환
        return 0, ""
df['intent'], df['query'] = zip(*df['key'].apply(parse_key))

print(df.head(30)) # 데이터프레임 확인

df.to_csv('/data/ephemeral/home/upstageailab-ir-competition-ir_s3/baseline/data/eval_added.csv', index=False, encoding='utf-8-sig')
df.to_json('/data/ephemeral/home/upstageailab-ir-competition-ir_s3/baseline/data/eval_added.jsonl',
           orient='records', lines=True, force_ascii=False)

# 추가 요약
# 생물학(Biology): 그리스어 bios(생명) + logos(학문). 인체, 유전, 생태계 전반 다룸.
# 화학(Chemistry): 그리스어 khemeia(금속 변환). 물질의 성질, 반응, 분석 기법 등.
# 물리학(Physics): 그리스어 physis(자연). 역학, 전자기, 열역학, 현대물리까지 포괄.
# 지구과학·천문학(Geoscience & Astronomy): 지질, 기상, 우주 구조, 별·행성 탐구.
# 환경·생태(환경과학): 오염, 자원 관리, 생태계 보전 등 지속 가능성 중점.
# 공학·기술(Engineering & Tech): 에너지·정보·재료공학, IT·보안 등 실용적 응용.
# 의학·건강(Medicine & Health): 질병, 면역, 영양·대사, 예방·치료 접근법.
# 사회과학·심리(Social & Psychology): 인구·복지, 발달·정신건강, 행동 이론.
# 연구 방법론(Methodology): 가설-실험-데이터 해석, 통계 활용, 과학사의 발전.
# 기타(최신 과학·철학): 우주 탐사, 나노·유전자 기술, 과학 철학 등.